<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>å®®ãƒ¶ç€¬ãƒ€ãƒ  å¤šè¨€èªã‚¬ã‚¤ãƒ‰</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Noto Sans JP",
        sans-serif;
      margin: 0;
      padding: 0;
      background: #f5f5f5;
      color: #222;
    }

    header {
      padding: 16px;
      background: #0066cc;
      color: white;
      text-align: center;
    }

    header h1 {
      margin: 0;
      font-size: 20px;
    }

    main {
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
    }

    #langLabel {
      font-size: 14px;
      color: #555;
      margin-bottom: 4px;
    }

    #guideText {
      background: #ffffff;
      border-radius: 8px;
      padding: 12px 14px;
      margin-bottom: 12px;
      line-height: 1.6;
      font-size: 14px;
      border: 1px solid #ddd;
    }

    #speakButton {
      padding: 10px 18px;
      font-size: 16px;
      border-radius: 8px;
      border: none;
      background: #0078ff;
      color: #fff;
      cursor: pointer;
      margin-bottom: 16px;
    }

    #speakButton:hover {
      background: #005fcc;
    }

    iframe {
      width: 100%;
      height: 70vh;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: white;
    }

    footer {
      text-align: center;
      font-size: 12px;
      color: #777;
      padding: 12px;
    }
  </style>
</head>
<body>
  <header>
    <h1 id="pageTitle">å®®ãƒ¶ç€¬ãƒ€ãƒ  å¤šè¨€èªã‚¬ã‚¤ãƒ‰</h1>
  </header>
  <main>
    <div id="langLabel"></div>
    <div id="guideText"></div>
    <button id="speakButton">ğŸ”Š ã“ã®æ¡ˆå†…ã‚’éŸ³å£°ã§èã</button>
    <iframe id="pdfFrame" title="å®®ãƒ¶ç€¬ãƒ€ãƒ ã‚¬ã‚¤ãƒ‰PDF"></iframe>
  </main>
  <footer>
    Powered by Pæ „æ–‡èˆ / QRå¤šè¨€èªã‚¬ã‚¤ãƒ‰
  </footer>

  <script>
    // ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰è¨€èªã‚’å–å¾—ã—ã¦ã€ja / en / fr / ko / zh-cn ã®ã„ãšã‚Œã‹ã«æ­£è¦åŒ–
    function detectLang() {
      const langs = navigator.languages || [navigator.language || "ja"];
      const supported = ["ja", "en", "fr", "ko", "zh-cn"];

      for (const raw of langs) {
        if (!raw) continue;
        const lower = raw.toLowerCase(); // fr-fr
        const base = lower.split("-")[0]; // fr

        if (supported.includes(lower)) return lower;
        if (supported.includes(base)) return base;
        if (base === "zh") return "zh-cn";
      }
      return "ja";
    }

    // è¨€èªã”ã¨ã®ãƒ†ã‚­ã‚¹ãƒˆ
    const TEXTS = {
      "ja": {
        title: "å®®ãƒ¶ç€¬ãƒ€ãƒ  å¤šè¨€èªã‚¬ã‚¤ãƒ‰",
        label: "ç¾åœ¨ã®è¡¨ç¤ºè¨€èªï¼šæ—¥æœ¬èª",
        guide:
          "ã“ã®ãƒšãƒ¼ã‚¸ã§ã¯ã€ãŠä½¿ã„ã®ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®è¨€èªè¨­å®šã«åˆã‚ã›ã¦ã€ã€Œå®®ãƒ¶ç€¬ãƒ€ãƒ ã€ã®ã”æ¡ˆå†…PDFã‚’è‡ªå‹•è¡¨ç¤ºã—ã¾ã™ã€‚ä¸‹ã®PDFã‚’æ‹¡å¤§ã—ã¦ã”è¦§ãã ã•ã„ã€‚éŸ³å£°ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã“ã®æ¡ˆå†…æ–‡ã‚’æ—¥æœ¬èªã§èª­ã¿ä¸Šã’ã¾ã™ã€‚"
      },
      "en": {
        title: "Miyagase Dam Multilingual Guide",
        label: "Current language: English",
        guide:
          "This page automatically shows the Miyagase Dam guide PDF that best matches your device language. Please zoom in on the PDF below to read the details. Tap the speaker button to listen to this summary in English."
      },
      "fr": {
        title: "Guide multilingue du barrage de Miyagase",
        label: "Langue affichÃ©e : franÃ§ais",
        guide:
          "Cette page affiche automatiquement le guide PDF du barrage de Miyagase correspondant Ã  la langue de votre appareil. Agrandissez le PDF ci-dessous pour lire les dÃ©tails. Appuyez sur le bouton haut-parleur pour Ã©couter ce rÃ©sumÃ© en franÃ§ais."
      },
      "ko": {
        title: "ë¯¸ì•¼ê°€ì„¸ ëŒ ë‹¤êµ­ì–´ ì•ˆë‚´",
        label: "í˜„ì¬ í‘œì‹œ ì–¸ì–´: í•œêµ­ì–´",
        guide:
          "ì´ í˜ì´ì§€ëŠ” ì‚¬ìš©í•˜ì‹œëŠ” ìŠ¤ë§ˆíŠ¸í° ì–¸ì–´ ì„¤ì •ì— ë§ì¶° ë¯¸ì•¼ê°€ì„¸ ëŒ ì•ˆë‚´ PDFë¥¼ ìë™ìœ¼ë¡œ í‘œì‹œí•©ë‹ˆë‹¤. ì•„ë˜ PDFë¥¼ í™•ëŒ€í•˜ì—¬ ìì„¸í•œ ë‚´ìš©ì„ í™•ì¸í•˜ì„¸ìš”. ìŠ¤í”¼ì»¤ ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì´ ì•ˆë‚´ë¬¸ì„ í•œêµ­ì–´ë¡œ ì½ì–´ ì¤ë‹ˆë‹¤."
      },
      "zh-cn": {
        title: "å®«ãƒ¶ç€¬å¤§åå¤šè¯­è¨€æŒ‡å—",
        label: "å½“å‰æ˜¾ç¤ºè¯­è¨€ï¼šç®€ä½“ä¸­æ–‡",
        guide:
          "æœ¬é¡µé¢ä¼šæ ¹æ®æ‚¨æ‰‹æœºçš„è¯­è¨€è®¾ç½®ï¼Œè‡ªåŠ¨æ˜¾ç¤ºã€Šå®«ãƒ¶ç€¬å¤§åã€‹å¯¼è§ˆPDFã€‚è¯·æ”¾å¤§ä¸‹æ–¹çš„PDFæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯ã€‚ç‚¹å‡»æ‰¬å£°å™¨æŒ‰é’®ï¼Œå¯ç”¨ä¸­æ–‡æœ—è¯»æœ¬è¯´æ˜ã€‚"
      }
    };

    // è¨€èªã«å¿œã˜ã¦ç”»é¢ã¨PDFã‚’ã‚»ãƒƒãƒˆ
    function setupPage() {
      const lang = detectLang(); // ja / en / fr / ko / zh-cn
      const htmlLang = lang === "zh-cn" ? "zh-CN" : lang;
      document.documentElement.lang = htmlLang;

      const text = TEXTS[lang] || TEXTS["ja"];

      document.getElementById("pageTitle").innerText = text.title;
      document.getElementById("langLabel").innerText = text.label;
      document.getElementById("guideText").innerText = text.guide;

      // PDFã®URLã‚’è¨­å®šï¼ˆFlaskå´ã® /spot_miyagase/pdf/<lang> ã‚’å‘¼ã¶ï¼‰
      const pdfLang = lang; // ja / en / fr / ko / zh-cn
      document.getElementById("pdfFrame").src =
        "/spot_miyagase/pdf/" + pdfLang;
    }

    // éŸ³å£°èª­ã¿ä¸Šã’
    function setupSpeech() {
      const btn = document.getElementById("speakButton");
      btn.addEventListener("click", function () {
        const text = document.getElementById("guideText").innerText;
        if (!text) return;

        // ã™ã§ã«èª­ã¿ä¸Šã’ä¸­ãªã‚‰ä¸€åº¦æ­¢ã‚ã‚‹
        if (window.speechSynthesis.speaking) {
          window.speechSynthesis.cancel();
        }

        const u = new SpeechSynthesisUtterance(text);
        u.lang = document.documentElement.lang || "ja-JP";
        window.speechSynthesis.speak(u);
      });
    }

    document.addEventListener("DOMContentLoaded", function () {
      setupPage();
      setupSpeech();
    });
  </script>
</body>
</html>
